// api/index.js
import axios from 'axios';

export default async function handler(req, res) {
  // 1. Pobieramy nazwÄ™ uÅ¼ytkownika z linku (np. ?username=MaxPowerPL)
  const { username } = req.query;

  // Zabezpieczenie: jeÅ›li ktoÅ› nie poda nicku
  if (!username) {
    return res.status(400).send('Podaj parametr ?username=TwojNick');
  }

  try {
    // 2. Pobieramy dane z API GitHuba
    const githubResponse = await axios.get(`https://api.github.com/users/${username}`);
    const data = githubResponse.data;

    // Pobieramy konkretne statystyki
    const name = data.name || data.login;
    const repos = data.public_repos;
    const followers = data.followers;

    // 3. Tworzymy kod SVG (to jest nasz "obrazek" pisany kodem)
    // UÅ¼ywamy prostego HTML/SVG wewnÄ…trz stringa
    const svg = `
      <svg width="400" height="200" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
        <rect width="400" height="200" rx="15" fill="#1a1b27" stroke="#00f2ff" stroke-width="2"/>

        <text x="20" y="50" font-family="Arial" font-size="24" fill="#ffffff" font-weight="bold">
          ${name}'s Stats
        </text>

        <line x1="20" y1="70" x2="380" y2="70" stroke="#333" stroke-width="1"/>

        <text x="20" y="110" font-family="Arial" font-size="18" fill="#00f2ff">
          ðŸ“¦ Repositories: ${repos}
        </text>

        <text x="20" y="150" font-family="Arial" font-size="18" fill="#00f2ff">
          ðŸ‘¥ Followers: ${followers}
        </text>

        <a href="https://github.com/MaxPowerPL" target="_blank">
            <text x="380" y="190" font-family="Arial" font-size="10" fill="#666" text-anchor="end" style="cursor: pointer; text-decoration: underline;">
                Generated by MaxPowerPL
            </text>
        </a>
      </svg>
    `;

    // 4. WysyÅ‚amy odpowiedÅº
    // WaÅ¼ne: MÃ³wimy przeglÄ…darce, Å¼e to jest obrazek SVG, a nie tekst!
    res.setHeader('Content-Type', 'image/svg+xml');
    res.setHeader('Cache-Control', 's-maxage=60, stale-while-revalidate'); // Cache na 60 sekund
    res.status(200).send(svg);

  } catch (error) {
    // ObsÅ‚uga bÅ‚Ä™du (np. nie ma takiego uÅ¼ytkownika)
    res.status(500).send('BÅ‚Ä…d: Nie znaleziono uÅ¼ytkownika lub limit API wyczerpany.');
  }
}